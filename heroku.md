<p align="center"><img src="https://res.cloudinary.com/dtfbvvkyp/image/upload/v1566331377/laravel-logolockup-cmyk-red.svg" width="400"></p>

## Getting Started on Heroku with PHP

The tutorial assumes that you have:

- [a free Heroku account](https://signup.heroku.com/dc);
- [PHP installed locally](https://www.php.net/);
- [Composer installed locally](https://getcomposer.org/doc/00-intro.md).

#### Step 1 - Prepare your Laravel App or install new Laravel project

First step, you need to prepare your existing Laravel project or you can create new laravel project. To install new Laravel project you can type like this in your terminal.

```bash
    composer create-project — prefer-dist laravel/laravel newProject
```
After your Laravel project is ready, enter into your main project directory.

#### Step 2 - Prepare your Heroku CLI

Second step, you need to prepare your Heroku CLI in your computer. Heroku supported various operating system, you can take a look at this [Heroku CLI](https://devcenter.heroku.com/articles/heroku-cli#download-and-install).
Download and install Heroku installer base on your operating system.

After Heroku installation finish, you can back to your terminal and you can try to access Heroku in there, try to login into Heroku from your terminal

```bash
    heroku login
```

## Step 3 - Create a Heroku app

To create a new Heroku application that you can push to, use the heroku create command:

### Create an app name

```bash
    app_name=couch-shop
```

### Create Heroku app

```bash
    heroku create $app_name
```

It’s also a good practice to tell Heroku the language we should use for our builds, and that’s PHP:

```bash

    heroku buildpacks:add heroku/php --app $app_name
    heroku buildpacks:add heroku/nodejs --app $app_name

```

## Step 4 - Create Procfile

In this step, you need to create Procfile (Heroku configuration file) inside your main Laravel project directory. Then inside your Procfile, you can put this code line:

```conf
    web: vendor/bin/heroku-php-apache2 public/
```

## Deploying to Heroku

After that, you can save your Procfile, then back into your terminal and type

```bash
    git init
```

After that, you need to commit and push your project into Heroku by type

```bash
    git add .
    git commit -m “Initial Commit”
    git push heroku master
```

Now our Laravel App already deployed into Heroku, you can take a look at your Heroku dashboard.

## Step 5 - Adding APP_KEY to .env file

For Laravel to operate correctly you need to set APP_KEY:

```bash

heroku config:set --app $app_name APP_KEY=$(php artisan --no-ansi key:generate --show)

```
The application is now deployed. Ensure that at least one instance of the app is running:
```bash
    heroku ps:scale web=1
```
Now visit the app at the URL generated by its app name. As a handy shortcut, you can open the website as follows:

```bash
    heroku open
```
## Step 5 — Database configuration

Adding PostgreSQL to your Heroku app

```bash

    heroku addons:create heroku-postgresql:hobby-dev --app $app_name

```
At any point, you can find both the name of your PostgreSQL variable and its value by running the following:

```bash
    heroku config
```

On apps with multiple databases, or if you didn't get the DATABASE_URL set properly for some reason, you can promote a particular server to be the primary database:

$ heroku pg:promote HEROKU_POSTGRESQL_RED_URL


Configuring Laravel to use PostgreSQL

Once again, if this is real app, you're going to want to only be making these changes in your production configuration settings, but for now we're just hacking at a dummy app.

First, change the value of 'default' in app/config/database.php to 'pgsql'.

    'default' => 'pgsql',

Then, just like we did with MySQL, set the following at the top of your database.php:

$url = parse_url(getenv("DATABASE_URL"));

$host = $url["host"];
$username = $url["user"];
$password = $url["pass"];
$database = substr($url["path"], 1);

Then change your pgsql entry in that same file to be the following:

    'pgsql' => array(
        'driver'   => 'pgsql',
        'host'     => $host,
        'database' => $database,
        'username' => $username,
        'password' => $password,
        'charset'  => 'utf8',
        'prefix'   => '',
        'schema'   => 'public',
    ),

That's it! Commit and push and migrate:

$ git add .
$ git commit -m "Convert to use Heroku PostgreSQL database"
$ git push heroku master
$ heroku run php /app/artisan migrate


The last step is about database configuration, so we can running our migrations in Heroku. Actually to using MySQL service in Heroku we need to upgrade our membership. In this tutorial we will using PostgreSQL because it’s free :D

First, click “Resources” menu, then in the “Add-ons” side, click “Find more add-ons”. You’ll redirect into Heroku Add-ons page.

We will got some configuration value, for this moment we focus on “DATABASE_URL” value to setup our Laravel App database.

Now, open your config/database.php file, and in the top of file, put this code

    $DATABASE_URL=parse_url(‘DATABASE_URL’);

Change the ‘DATABASE_URL’ with your “DATABASE_URL” in the terminal previously. After that, setting your pgsql part became like this

Then, set the pgsql became your default database setup, like this
make the pgsql became your default database connection

Ok, now we need to commit and push our config/database.php update into Heroku repository. Back into terminal and running this

    git add .
    git commit -m “Update database connection”
    git push heroku master

After that, now you can running your migration in the terminal, like this

Successful, now you are ready to running your Laravel App with Heroku. 

## Additional Configuration

Optionally set your app's environment to development

```bash
    heroku config:set --app $app_name APP_ENV=development APP_DEBUG=true APP_LOG_LEVEL=debug
```

## Run migrations

```bash
    heroku run -a $app_name php artisan migrate
```

## License

The Laravel framework is open-sourced software licensed under the [MIT license](https://opensource.org/licenses/MIT).
