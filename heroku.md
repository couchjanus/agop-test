<p align="center"><img src="https://res.cloudinary.com/dtfbvvkyp/image/upload/v1566331377/laravel-logolockup-cmyk-red.svg" width="400"></p>

## Getting Started on Heroku with PHP

The tutorial assumes that you have:

- [a free Heroku account](https://signup.heroku.com/dc);
- [PHP installed locally](https://www.php.net/);
- [Composer installed locally](https://getcomposer.org/doc/00-intro.md).

#### Step 1 - Prepare your Laravel App or install new Laravel project

First step, you need to prepare your existing Laravel project or you can create new laravel project. To install new Laravel project you can type like this in your terminal.

```bash
    composer create-project — prefer-dist laravel/laravel newProject
```
After your Laravel project is ready, enter into your main project directory.

#### Step 2 - Prepare your Heroku CLI

Second step, you need to prepare your Heroku CLI in your computer. Heroku supported various operating system, you can take a look at this [Heroku CLI](https://devcenter.heroku.com/articles/heroku-cli#download-and-install).
Download and install Heroku installer base on your operating system.

After Heroku installation finish, you can back to your terminal and you can try to access Heroku in there, try to login into Heroku from your terminal

```bash
    heroku login
```

## Step 3 - Create a Heroku app

To create a new Heroku application that you can push to, use the heroku create command:

### Create an app name

```bash
    app_name=couch-shop
```

### Create Heroku app

```bash
    heroku create $app_name
```

It’s also a good practice to tell Heroku the language we should use for our builds, and that’s PHP:

```bash

    heroku buildpacks:add heroku/php --app $app_name
    heroku buildpacks:add heroku/nodejs --app $app_name

```

## Step 4 - Create Procfile

In this step, you need to create Procfile (Heroku configuration file) inside your main Laravel project directory. Then inside your Procfile, you can put this code line:

```conf
    web: vendor/bin/heroku-php-apache2 public/
```

## Deploying to Heroku

After that, you can save your Procfile, then back into your terminal and type

```bash
    git init
```

After that, you need to commit and push your project into Heroku by type

```bash
    git add .
    git commit -m “Initial Commit”
    git push heroku master
```

Now our Laravel App already deployed into Heroku, you can take a look at your Heroku dashboard.

## Step 5 - Adding APP_KEY to .env file

For Laravel to operate correctly you need to set APP_KEY:

```bash

heroku config:set --app $app_name APP_KEY=$(php artisan --no-ansi key:generate --show)

```
The application is now deployed. Ensure that at least one instance of the app is running:
```bash
    heroku ps:scale web=1
```
Now visit the app at the URL generated by its app name. As a handy shortcut, you can open the website as follows:

```bash
    heroku open
```
## Step 5 — Database configuration

Adding PostgreSQL to your Heroku app

```bash

    heroku addons:create heroku-postgresql:hobby-dev --app $app_name

```
At any point, you can find both the name of your PostgreSQL variable and its value by running the following:

```bash
    heroku config
```


## Configuring Laravel to use PostgreSQL

Now, open your config/database.php file, and in the top of file, put this code

```php
    $DATABASE_URL=parse_url(‘DATABASE_URL’);
```
Change the ‘DATABASE_URL’ with your “DATABASE_URL” in the terminal previously. After that, setting your pgsql part became like this
First, change the value of 'default' in app/config/database.php to 'pgsql'.
```php
    'default' => 'pgsql',
```

Then change your pgsql entry in that same file to be the following:

```php
        'pgsql' => [
            'driver' => 'pgsql',
            'host' => $DATABASE_URL['host'],
            'port' => $DATABASE_URL['post'],
            'database' => ltrim($DATABASE_URL['path'], '/'),
            'username' => $DATABASE_URL['user'],
            'password' => $DATABASE_URL['pass'],
            'charset' => 'utf8',
            'prefix' => '',
            'prefix_indexes' => true,
            'schema' => 'public',
            'sslmode' => 'prefer',
        ],
```

## Commit and push and migrate:

```bash
 git add .
 git commit -m "Convert to use Heroku PostgreSQL database"
 git push heroku master

```
## Run migrations

```bash
    heroku run -a $app_name php artisan migrate
```

## Additional Configuration

Optionally set your app's environment to development

```bash
    heroku config:set --app $app_name APP_ENV=development APP_DEBUG=true APP_LOG_LEVEL=debug
```


## Generate a URL for an asset using HTTPS:

```php

    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css?family=Nunito" rel="stylesheet">
    <!-- Bootstrap core CSS -->
    <link href="{{ secure_asset('css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ secure_asset('fontawesome/css/all.min.css') }}" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="{{ secure_asset('css/shop.css') }}" rel="stylesheet">

```
## License

The Laravel framework is open-sourced software licensed under the [MIT license](https://opensource.org/licenses/MIT).
